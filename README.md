# protogen

Tool to compile ``proto3`` schemas and generate C++ classes which serialize and deserialize JSON messages. The compiler generates a C++ header file to be included in your program. This file is all you need: no external dependencies.

There is also the ``libprotogen_static`` library you can use to create your own compiler or enable your application to compile ``proto3``.

## Build

```
# mkdir build && cd build && cmake ..
# make
```

## Usage

Create a ``.proto`` file:

```
syntax = "proto3";
option cpp_enable_errors = true;

message Person {
    string name = 1;
    int32 age = 2;
    repeated string colors = 3;
}
```

Compile ``.proto`` files using ``protogen`` program:

```
# ./protogen model.proto model.pg.hh
```

Include the generated header file in your source code to use the classe:

```c++
#include "model.pg.hh"

...

// create and populate an object
Person girl;
girl.name("Michelle");
girl.age(24);
girl.colors().push_back("yellow");

// JSON serialization
std::string json;
girl.serialize(json);

// JSON deserialization with error information (requires 'cpp_enable_errors' option)
Person person;
Person::ErrorInfo err;
if (!person.deserialize(json, false, &err))
    std::cerr << "Error: " << err.message << " at " << err.line << ':' << err.column << std::endl;

...
```

Compile your program as usual (no additional library is required). In the example above, the output would be:

```
{"name":"Michelle","age":24,"colors":["yellow"]}
```

## Supported options

* **obfuscate_strings** (top-level) &ndash; Enable string obfuscation. If enabled, all strings in the C++ generated file will be obfuscated with a very simple (and insecure) algorithm. The default value is `false`. This option can be used to make a little difficult for curious people to find out your JSON field names by inspecting binary files.
* **number_names** (top-level) &ndash; Use field numbers as JSON field names. The default value is `false`. If enabled, every JSON field name will be the number of the corresponding field in the `.proto` file. This can reduce significantly the size of the JSON output.
* **cpp_enable_parent** (top-level) &ndash; Enable (`true`) or disable (`false`) the use of a parent class. The default value is `false`. When enabled, every message will specialize the `Message` class which contains a virtual destructor and a couple of pure virtual functions. If you do not need a common ancestor for your message classes, you can keep this option disabled.
* **cpp_enable_errors** (top-level) &ndash; Enable (`true`) or disable (`false`) information about parsing errors. The default value is `false`. If enabled, `deserializer` functions will populate the `ErrorInfo` object given as argument. This option can also be enabled by defining the `PROTOGEN_CPP_ENABLE_ERRORS` macro before including the generated C++ header.
* **transient** (field-level) &ndash; Make the field transient ('true') or not ('false'). Transient fields are not serialized/deserialized. The default value is 'false'.
* **custom_parent** (top-level) &ndash; Define a custom parent class for all messages. Use the same syntax as package definition.

## Features

Supported field types:
- [x] other messages (see [Limitations](#Limitations))
- [x] repeated
- [x] double
- [x] float
- [x] int32
- [x] int64
- [x] uint32
- [x] uint64
- [x] sint32
- [x] sint64
- [x] fixed32
- [x] fixed64
- [x] sfixed32
- [x] sfixed64
- [x] bool
- [x] string
- [x] bytes
- [ ] any
- [ ] oneof
- [ ] maps

Proto3 syntax features:
- [x] Line comments
- [x] Block comments
- [x] Packages
- [ ] Imports
- [x] Options

## Limitations

These are the current limitations of the implementation. Some of them may be removed in future versions.

Proto3 parser:
- You cannot import additional ``.proto`` files;
- Circular references are not supported;

JSON parser:
- Strings do not support ``\u`` to specify unicode endpoints;
- ``null`` values are not recognized.

## Next steps

- Add support for maps
- Add support for imports

## License

The library and the compiler are distributed under [Apache License 2.0](http://www.apache.org/licenses/LICENSE-2.0).

Code generated by **protogen** compiler is distributed under [The Unlicense](http://unlicense.org). That means you can use the generated source code in any proprietary or open-source project. Additionally, you do not have to give credits or state you used **protogen** (but that would be great!).